# yaml-language-server: $schema=../skill-scenarios.schema.json
# Test scenarios for azure-keyvault-keys-rust skill evaluation
# Each scenario tests a specific usage pattern against acceptance criteria

config:
  model: gpt-4
  max_tokens: 2000
  temperature: 0.3

scenarios:
  - name: create_key_client
    prompt: |
      Create a Key Vault KeyClient in Rust using DeveloperToolsCredential.
    expected_patterns:
      - "DeveloperToolsCredential"
      - "KeyClient"
      - "vault.azure.net"
    forbidden_patterns:
      - "SecretClient"
    tags:
      - basic
      - authentication
    mock_response: |
      use azure_identity::DeveloperToolsCredential;
      use azure_security_keyvault_keys::KeyClient;

      let credential = DeveloperToolsCredential::new(None)?;
      let client = KeyClient::new(
          "https://<vault-name>.vault.azure.net/",
          credential.clone(),
          None,
      )?;

  - name: get_key
    prompt: |
      Retrieve a key from Azure Key Vault using the Rust SDK.
    expected_patterns:
      - "get_key"
      - "into_model"
    forbidden_patterns:
      - "create_key"
    tags:
      - read
      - keys
    mock_response: |
      let key = client
          .get_key("key-name", None)
          .await?
          .into_model()?;

      println!("Key ID: {:?}", key.key.as_ref().map(|k| &k.kid));

  - name: create_rsa_key
    prompt: |
      Create an RSA key in Azure Key Vault using Rust.
    expected_patterns:
      - "create_key"
      - "CreateKeyParameters"
      - "KeyType"
      - "Rsa"
    forbidden_patterns:
      - "Ec"
    tags:
      - create
      - rsa
    mock_response: |
      use azure_security_keyvault_keys::models::{CreateKeyParameters, KeyType};

      let params = CreateKeyParameters {
          kty: KeyType::Rsa,
          key_size: Some(2048),
          ..Default::default()
      };

      let key = client
          .create_key("key-name", params.try_into()?, None)
          .await?
          .into_model()?;

  - name: create_ec_key
    prompt: |
      Create an Elliptic Curve (EC) key with P-256 curve in Azure Key Vault using Rust.
    expected_patterns:
      - "create_key"
      - "KeyType::Ec"
      - "CurveName"
      - "P256"
    forbidden_patterns:
      - "Rsa"
    tags:
      - create
      - ec
    mock_response: |
      use azure_security_keyvault_keys::models::{CreateKeyParameters, KeyType, CurveName};

      let params = CreateKeyParameters {
          kty: KeyType::Ec,
          curve: Some(CurveName::P256),
          ..Default::default()
      };

      let key = client
          .create_key("ec-key", params.try_into()?, None)
          .await?
          .into_model()?;

  - name: list_keys
    prompt: |
      List all keys in an Azure Key Vault using the Rust SDK.
    expected_patterns:
      - "list_key_properties"
      - "into_stream"
      - "try_next"
    forbidden_patterns:
      - "get_key"
    tags:
      - list
      - keys
    mock_response: |
      use azure_security_keyvault_keys::ResourceExt;
      use futures::TryStreamExt;

      let mut pager = client.list_key_properties(None)?.into_stream();
      while let Some(key) = pager.try_next().await? {
          let name = key.resource_id()?.name;
          println!("Key: {}", name);
      }

  - name: delete_key
    prompt: |
      Delete a key from Azure Key Vault using Rust.
    expected_patterns:
      - "delete_key"
    forbidden_patterns:
      - "purge"
    tags:
      - delete
      - keys
    mock_response: |
      client.delete_key("key-name", None).await?;
